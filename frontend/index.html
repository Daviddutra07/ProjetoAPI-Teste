<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financeiro Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen">

    <div class="max-w-4xl mx-auto p-6">
        <h1 class="text-3xl font-extrabold text-slate-800 mb-8">ðŸ’° Meu Financeiro</h1>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-green-500">
                <p class="text-sm text-gray-500 font-medium uppercase">Entradas</p>
                <p id="resumo-entradas" class="text-2xl font-bold text-green-600">R$ 0,00</p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-red-500">
                <p class="text-sm text-gray-500 font-medium uppercase">DÃ­vidas (SaÃ­das)</p>
                <p id="resumo-saidas" class="text-2xl font-bold text-red-600">R$ 0,00</p>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-sm border-l-4 border-blue-500">
                <p class="text-sm text-gray-500 font-medium uppercase">Saldo Total</p>
                <p id="resumo-saldo" class="text-2xl font-bold text-slate-800">R$ 0,00</p>
            </div>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-md mb-8">
            <h2 class="text-lg font-bold mb-4">Novo LanÃ§amento</h2>
            <form id="form" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                <input id="titulo" placeholder="Ex: Aluguel" class="border p-2 rounded-lg focus:ring-2 focus:ring-blue-400 outline-none" required>
                <input id="valor" type="number" step="0.01" placeholder="Valor (R$)" class="border p-2 rounded-lg" required>
                <input id="data" type="date" class="border p-2 rounded-lg">
                
                <select id="tipo" class="border p-2 rounded-lg">
                    <option value="saida">ðŸ”´ SaÃ­da (DÃ­vida)</option>
                    <option value="entrada">ðŸŸ¢ Entrada (Receita)</option>
                </select>

                <select id="status" class="border p-2 rounded-lg">
                    <option value="ativo">Pendente</option>
                    <option value="concluido">Pago/Recebido</option>
                </select>

                <button class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition">
                    + Adicionar
                </button>
            </form>
        </div>

        <div class="bg-white rounded-xl shadow-md overflow-hidden">
            <div class="p-4 border-b bg-gray-50 flex justify-between items-center">
                <h3 class="font-bold">HistÃ³rico</h3>
                <div class="flex gap-2">
                    <select id="filtro-tipo" class="text-sm border rounded p-1">
                        <option value="">Todos os tipos</option>
                        <option value="entrada">Entradas</option>
                        <option value="saida">SaÃ­das</option>
                    </select>
                </div>
            </div>
            <ul id="lista" class="divide-y divide-gray-100">
                </ul>
        </div>
        <footer class="w-full border-t border-gray-200 bg-white text-sm text-gray-600">
            <div class="max-w-7xl mx-auto px-4 py-4 flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
            
            <div>
                <span class="font-medium text-gray-700">Fale conosco:</span>
                <a href="mailto:contato@exemplo.com" class="ml-1 text-blue-600 hover:underline">
                contato@ficticio.com
                </a>
            </div>

            <div>
                <a href="https://github.com/Daviddutra07/ProjetoAPI-Teste.git" target="_blank"
                class="text-blue-600 hover:underline">
                GitHub do projeto
                </a>
            </div>

            </div>
        </footer>
    </div>

    <script>
        const API = "http://127.0.0.1:5000/items";

        async function carregarDados() {
            // Buscar Itens
            const tipo = document.getElementById('filtro-tipo').value;
            const res = await fetch(`${API}?tipo=${tipo}`);
            const items = await res.json();
            
            // Buscar Resumo MatemÃ¡tico
            const resResumo = await fetch(`${API}/summary`);
            const resumo = await resResumo.json();

            renderizar(items, resumo);
        }

        function renderizar(items, resumo) {
            // Atualiza os Cards
            document.getElementById('resumo-entradas').innerText = `R$ ${resumo.total_entradas.toFixed(2)}`;
            document.getElementById('resumo-saidas').innerText = `R$ ${resumo.total_saidas.toFixed(2)}`;
            document.getElementById('resumo-saldo').innerText = `R$ ${resumo.saldo.toFixed(2)}`;

            // Atualiza a Lista
            const lista = document.getElementById('lista');
            lista.innerHTML = items.map(i => `
                <li class="p-4 flex justify-between items-center hover:bg-gray-50">
                    <div>
                        <p class="font-semibold text-slate-700">${i.titulo}</p>
                        <p class="text-xs text-gray-400">${i.data || 'Sem data'}</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="font-bold ${i.tipo === 'entrada' ? 'text-green-500' : 'text-red-500'}">
                            ${i.tipo === 'entrada' ? '+' : '-'} R$ ${i.valor.toFixed(2)}
                        </span>
                        <button onclick="deletar(${i.id})" class="text-gray-300 hover:text-red-500 text-sm">âœ–</button>
                    </div>
                </li>
            `).join('');
        }

        document.getElementById('form').onsubmit = async (e) => {
            e.preventDefault();
            const payload = {
                titulo: document.getElementById('titulo').value,
                valor: document.getElementById('valor').value,
                tipo: document.getElementById('tipo').value,
                status: document.getElementById('status').value,
                data: document.getElementById('data').value
            };

            await fetch(API, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            });
            
            e.target.reset();
            carregarDados();
        };

        async function deletar(id) {
            await fetch(`${API}/${id}`, { method: 'DELETE' });
            carregarDados();
        }

        document.getElementById('filtro-tipo').onchange = carregarDados;

        // Inicializar
        carregarDados();
    </script>
</body>
</html>